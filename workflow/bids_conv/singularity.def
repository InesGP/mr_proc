BootStrap: docker
From: ubuntu:18.04

%environment
    export LC_ALL="C.UTF-8"
    export PATH="/opt/dcm2niix-v1.0.20211006/bin:$PATH"

%post
    apt-get update && apt-get install -y --no-install-recommends \
    git \
    libhdf5-serial-dev \
    build-essential \
    python3.6-dev \
    python3.6 \
    python3-pip \
    && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

    pip3 install -U setuptools cython wheel
    pip3 install traits pandas numpy scipy
    pip3 install git+https://github.com/nipy/heudiconv.git@cb2fd912b8310d7022e9358a84c3b589fe3c07e8

    apt-get update -qq \
    && apt-get install -y -q --no-install-recommends \
           apt-utils \
           bzip2 \
           ca-certificates \
           curl \
           locales \
           unzip \
    && apt-get clean \
    && sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \
    && dpkg-reconfigure --frontend=noninteractive locales \
    && update-locale LANG="en_US.UTF-8" \
    && chmod 777 /opt && chmod a+s /opt \

    apt-get update -qq \
    && apt-get install -y -q --no-install-recommends \
           cmake \
           g++ \
           gcc \
           git \
           make \
           pigz \
           zlib1g-dev \
    && apt-get clean \
    
    rm -rf /tmp/dcm2niix
    git clone https://github.com/rordenlab/dcm2niix /tmp/dcm2niix \
        && cd /tmp/dcm2niix \
        && git fetch --tags \
        && git checkout v1.0.20211006 \
        && mkdir /tmp/dcm2niix/build \
        && cd /tmp/dcm2niix/build \
        && cmake  -DCMAKE_INSTALL_PREFIX:PATH=/opt/dcm2niix-v1.0.20211006 .. \
        && make \
        && make install \
        && rm -rf /tmp/dcm2niix
    
%runscript
     exec "$@"
